
# 1. 개요
본 문서는 콘서트 예매 시스템에서 실시된 부하 테스트 결과를 바탕으로 발생할 수 있는 다양한 장애 상황에 대한 대응 방안을 제시합니다. 특히, 주요 API의 성능 및 안정성을 보장하기 위한 구체적인 조치를 포함하여, 장애 발생 시 신속하고 효율적으로 대응할 수 있는 지침을 제공합니다.

# 2. 잠재적 장애 시나리오 및 대응 방안

## 2.1 상위상품조회 API 과부하 시나리오
다수의 사용자가 동시 접근하여 상위상품조회 API에 과부하가 발생, 응답 시간이 급격히 증가하고 시스템 리소스가 고갈되는 상황을 가정합니다. 이는 사용자 경험 저하 및 전체 시스템의 성능 저하로 이어질 수 있습니다.

### 징후
- 응답 시간이 500ms 이상 지속적으로 증가
- CPU 사용률 90% 이상 유지
- 메모리 사용량 85% 이상 도달

### 대응 방안
- 즉시 조치 (20분 이내)

```
API 캐싱 강화: 상위상품조회 API의 결과를 Redis와 같은 인메모리 데이터베이스에 캐싱하여 트래픽을 분산
비효율적 쿼리 탐지 및 최적화: 즉각적으로 실행 계획을 분석하고 성능을 저해하는 쿼리를 최적화
트래픽 제한 설정: API Gateway를 통해 초당 요청 수를 제한하여 서버 안정성 확보
```


- 단기 조치 (2시간 이내)
```
서버 리소스 증설: 클라우드 인프라의 경우, CPU 및 메모리 자원을 확장
복제본 활용: 데이터베이스의 읽기 전용 복제본을 활용하여 부하 분산
```
- 장기 조치 (1주일 이내)
```
API 게이트웨이와 로드 밸런서를 통한 트래픽 관리 체계 강화
상위상품조회 API의 아키텍처 재설계: 마이크로서비스로 분리하여 확장성 향상
```

## 2.2 유저잔액조회 API 장애 시나리오
유저잔액조회 API에 다수의 요청이 몰려 데이터베이스 조회 부하가 증가하고, 일부 요청이 타임아웃 또는 오류를 반환하는 상황을 가정합니다.

### 징후
- 데이터베이스 연결 실패 로그 급증
- API 응답 시간 1000ms 이상
- 사용자 불만 신고 급증


### 대응 방안

- 즉시 조치 (15분 이내)
```
캐시 우회: 잔액 조회 정보를 최근 요청 기준으로 캐싱하여 데이터베이스 부하 감소
연결 풀 크기 증가: 데이터베이스 연결 풀을 일시적으로 확대하여 처리량 증가
사용자 안내: 잠재적 지연에 대해 사용자에게 즉시 공지
```

- 단기 조치 (1시간 이내)
```
문제 API의 리팩토링: 쿼리 최적화 및 비동기 처리로 부하를 분산
데이터베이스 튜닝: 인덱스 최적화 및 쿼리 실행 계획 분석 후 조정
```

- 장기 조치 (1주일 이내)
```
데이터베이스 샤딩: 사용자 ID를 기준으로 데이터베이스를 분할하여 성능 향상
지속적인 성능 모니터링: 실시간으로 유저잔액조회 API의 성능을 추적하고, 이상 징후 조기 감지
```

## 2.3 주문하기 API 과부하 시나리오
주문하기 API에 갑작스러운 트래픽 증가로 인해 응답 속도가 저하되고, 서버 메모리 사용량이 한계에 도달하는 상황을 가정합니다.


### 징후
1. 응답 지연 시간 1500ms 이상
2. 서버 메모리 사용량 95% 도달
3. 일부 사용자의 주문 실패 보고


### 대응 방안

- 즉시 조치 (10분 이내):
```
비동기 처리 적용: 주문 요청을 비동기적으로 처리하여 서버 부하 분산
서버 재시작: 메모리 누수 발생 시 서버 인스턴스를 순차적으로 재시작하여 안정성 확보
사용자 안내: 주문이 지연될 수 있음을 사용자에게 공지
```


- 단기 조치 (2시간 이내)
```
서버 인스턴스 추가: 자동 스케일링을 통해 서버 인스턴스를 추가하여 부하 분산
메모리 사용 최적화: JVM 튜닝 및 힙 메모리 관리 최적화
```

- 장기 조치 (2주 이내)

```
서비스 메쉬 도입: 주문하기 API의 요청을 여러 서버에 균등 분산하는 구조로 전환
데이터베이스 최적화: 주문 트랜잭션 처리 속도 향상을 위한 쿼리 및 인덱스 최적화
```

# 3. 후속 조치
부하 테스트 이후, 발생한 장애에 대한 원인 분석 및 대응 방안을 문서화하고, 성능 개선을 위한 장기적 계획을 수립합니다. 이와 함께 주기적인 스트레스 테스트 및 모니터링 강화를 통해 시스템의 안정성과 성능을 지속적으로 향상시킵니다.
